\section*{Алгоритм программы}

\subsection*{Модуль truck}

\subsubsection*{Truck}

\begin{lstlisting}
	Truck();
\end{lstlisting}

\begin{itemize}
	\item \verb|id = -1;|
	\item \verb|brand = TruckBrand::NONE;|
	\item \verb|capacity = 0.f;|
	\item \verb|transportation_distance = 0;|
	\item \verb|prev = nullptr;|
	\item \verb|next = nullptr;|
\end{itemize}

\subsubsection*{Truck}

\begin{lstlisting}
Truck(const Truck &truck);
\end{lstlisting}

\begin{itemize}
	\item \verb|id = truck.id;|
	\item \verb|brand = truck.brand;|
	\item \verb|capacity = truck.capacity;|
	\item \verb|transportation_distance = truck.transportation_distance;|
	\item \verb|prev = nullptr;|
	\item \verb|next = nullptr;|
\end{itemize}

\subsection*{Модуль truck\_list}

\subsubsection*{Get}

\begin{lstlisting}
Truck *Get(int index) const;
\end{lstlisting}

\begin{itemize}
	\item \verb|_check_index(index);|
	\item \verb|auto p = head;|
	\item Цикл по \verb|i| от \verb|0| до \verb|index|
	\begin{itemize}
		\item Если \verb|p->next|
		\item \verb|    p = p->next;|
		\item Иначе
		\item \verb|    return nullptr;|
	\end{itemize}
	\item \verb|return p;|
\end{itemize}

\subsubsection*{Add}

\begin{lstlisting}
Truck *Add(const Truck &truck);
\end{lstlisting}

\begin{itemize}
	\item \verb|auto *new_node = new Truck(truck);|
	\item Если \verb|if (size == 0)|
	\begin{itemize}
		\item \verb|head = new_node;|
		\item \verb|tail = new_node;|
		\item \verb|new_node->prev = nullptr;|
		\item \verb|new_node->next = nullptr;|
	\end{itemize}
	\item Иначе
	\begin{itemize}
		\item \verb|new_node->prev = tail;|
		\item \verb|new_node->prev->next = new_node;|
		\item \verb|new_node->next = nullptr;|
		\item \verb|tail = new_node;|
	\end{itemize}
	\item \verb|++size;|
	\item \verb|return new_node;|
\end{itemize}

\subsubsection*{Delete}

\begin{lstlisting}
void Truck(int index);
\end{lstlisting}

\begin{itemize}
	\item \verb|_check_index(index);|
	\item Если \verb|size == 1 && index == 0|
	\begin{itemize}
		\item \verb|Free();|
		\item \verb|return;|
	\end{itemize}
	\item Если \verb|index == 0|
	\begin{itemize}
		\item \verb|Truck *new_head = head->next;|
		\item \verb|delete head;|
		\item \verb|head = new_head;|
		\item \verb|head->prev = nullptr;|
		\item \verb|--size;|
		\item \verb|return;|
	\end{itemize}
	\item Если \verb|index == size - 1|
	\begin{itemize}
		\item \verb|Truck *new_tail = tail->prev;|
		\item \verb|delete tail;|
		\item \verb|tail = new_tail;|
		\item \verb|tail->next = nullptr;|
		\item \verb|--size;|
		\item \verb|return;|
	\end{itemize}
	\item \verb|auto p = Get(index);|
	\item Если \verb|!p|
	\begin{itemize}
		\item \verb|return;|
	\end{itemize}
	\item \verb|p->next->prev = p->prev;|
	\item \verb|p->prev->next = p->next;|
	\item \verb|delete p;|
	\item \verb|--size;|
\end{itemize}

\subsubsection*{Free}

\begin{lstlisting}
void Free();
\end{lstlisting}

\begin{itemize}
	\item \verb|Truck *p = head;|
	\item Пока \verb|p != nullptr|
	\begin{itemize}
		\item \verb|Truck *next = p->next;|
		\item \verb|delete p;|
		\item \verb|p = next;|
	\end{itemize}
	\item \verb|head = nullptr;|
	\item \verb|tail = nullptr;|
	\item \verb|size = 0;|
\end{itemize}

\subsubsection*{\_check\_index}

\begin{lstlisting}
void _check_index(const int &index) const;
\end{lstlisting}

\begin{itemize}
	\item Если \verb|index < 0 |||\verb| index >= size)|
	\begin{itemize}
		\item \verb|std::stringstream message;|
		\item \verb|message << "Index out of range (possible [0-" << size-1 << "], given " << index << ")";|
		\item \verb|throw std::out_of_range(message.str().c_str());|
	\end{itemize}
\end{itemize}

\subsection*{Модуль truck\_db}

\subsubsection*{TruckDataBase}

\begin{lstlisting}
TruckDataBase(ScheduleDataBase *schedule_p, const std::string &db_path_ = "../dbs/truckdb.csv");
\end{lstlisting}

\begin{itemize}
	\item \verb|schedule = schedule_p;|
	\item \verb|db_path = db_path_;|
	\item \verb|_loadDataBase();|
\end{itemize}

\subsubsection*{PrintAll}

\begin{lstlisting}
void PrintAll() const;
\end{lstlisting}

\begin{itemize}
	\item \verb|std::cout << std::left|\\
	\verb|<< std::setw(4)  << "id "|\\
	\verb|<< std::setw(14) << "brand "|\\
	\verb|<< std::setw(10)  << "capacity "|\\
	\verb|<< std::setw(5)  << "transportation_distance\n";|
	\item Цикл по \verb|i| от \verb|0| до \verb|list.size| 
	\begin{itemize}
		\item \verb|Print(i);|
	\end{itemize}
\end{itemize}

\subsubsection*{Print}

\begin{lstlisting}
void Print(int index) const;
\end{lstlisting}

\begin{itemize}
	\item \verb|list._check_index(index);|
	\item \verb|auto p = list.Get(index);|
	\item \verb|std::cout << std::left|
	\verb|<< std::setw(3)  << p-> id << " "|\\
	\verb|<< std::setw(13) << str(p->brand) << " "|\\
	\verb|<< std::setw(9)  << p->capacity << " "|\\
	\verb|<< std::setw(5)  << p->transportation_distance << "\n";|
\end{itemize}

\subsubsection*{Find}

\begin{lstlisting}
Truck *Find(Request *request) const;
\end{lstlisting}

\begin{itemize}
	\item \verb|Truck *pTruck = list.head;|
	\item Пока \verb|pTruck|
	\begin{itemize}
		\item Если \verb|(|\\
		\verb|(pTruck->brand != request->truck_brand) |||\\
		\verb|(pTruck->capacity < request->cargo_weight) |||\\ 
		\verb|(pTruck->transportation_distance < request->target_route->distance) |||\\
		\verb|(!schedule->IsFree(pTruck, request))|\\
		\verb|)|
		\begin{itemize}
			\item \verb|pTruck = pTruck->next;|
			\item \verb|continue;|
		\end{itemize}
		\item \verb|return pTruck;|
	\end{itemize}
	\item \verb|return nullptr;|
\end{itemize}

\subsubsection*{Edit}

\begin{lstlisting}
void Edit(int index);
\end{lstlisting}

\begin{itemize}
	\item \verb|list._check_index(index);|
	\item \verb|Truck *target_element = list.Get(index);|
	\item Пока \verb|true|
	\begin{itemize}
		\item \verb|std::cout << "------------------------\n";|
		\item \verb|Print(index);|
		\item \verb|std::cout << "------------------------\n";|
		\item \verb|std::cout << "Choose filed:\n";|
		\item \verb|std::cout << "1 brand" << "\n";|
		\item \verb|std::cout << "2 capacity" << "\n";|
		\item \verb|std::cout << "3 distance" << "\n";|
		\item \verb|std::cout << "0 Finish edit" << "\n";|
		\item \verb|int option = InputInt("Input: ");|
		\item Смотрим на \verb|option|
		\begin{itemize}
			\item Если \verb|1:|
			\item \verb|    target_element->brand = InputTB("New value: ");|
			\item \verb|    break;|
			\item Если \verb|2:|
			\item \verb|    target_element->capacity = InputInt("New value: ");|
			\item \verb|    break;|
			\item Если \verb|3:|
			\item \verb|    target_element->transportation_distance = InputInt("New value: ");|
			\item \verb|    break;|
			\item Если \verb|0: _updateDbFile(); return;|
			\item По умолчанию \verb|: std::cout << "\nIncorrect input\n\n";|
		\end{itemize}
	\end{itemize}
\end{itemize}

\subsubsection*{Add}

\begin{lstlisting}
void Add();
\end{lstlisting}

\begin{itemize}
	\item \verb|Truck new_element;|
	\item \verb|new_element.id = list.Get(list.size-1)->id + 1;|
	\item \verb|new_element.brand = InputTB("brand: ");|
	\item \verb|new_element.capacity = InputInt("capacity: ");|
	\item \verb|new_element.transportation_distance = InputInt("transportation distance: ");|
	\item \verb|list.Add(new_element);|
	\item \verb|_updateDbFile();|
\end{itemize}

\subsubsection*{Delete}

\begin{lstlisting}
void Delete(int index);
\end{lstlisting}

\begin{itemize}
	\item \verb|list.Delete(index);|
	\item Цикл по \verb|i| от \verb|index| до \verb|list.size| 
	\begin{itemize}
		\item \verb|list.Get(i)->id = i;|
	\end{itemize}
	\item \verb|_updateDbFile();|
\end{itemize}

\subsubsection*{Exit}

\begin{lstlisting}
void Exit();
\end{lstlisting}

\begin{itemize}
	\item \verb|list.Free();|
\end{itemize}

\subsubsection*{\_loadDataBase}

\begin{lstlisting}
void _loadDataBase();
\end{lstlisting}

\begin{itemize}
	\item \verb|Truck truck{};|
	\item \verb|io::CSVReader<4> in(db_path);|
	\item \verb|in.read_header(io::ignore_extra_column, "id", "brand", "capacity", "transportation_distance");|
	\item \verb|int brand_code;|
	\item Пока \verb|in.read_row(truck.id, brand_code, truck.capacity, truck.transportation_distance)|
	\begin{itemize}
		\item \verb|truck.brand = static_cast<TruckBrand>(brand_code);|
		\item \verb|list.Add(truck);|
	\end{itemize}
\end{itemize}

\subsubsection*{\_updateDbFile}

\begin{lstlisting}
void _updateDbFile() const;
\end{lstlisting}

\begin{itemize}
	\item \verb|std::ofstream fout(db_path, std::ios_base::trunc);|
	\item \verb|fout << "id,brand,capacity,transportation_distance\n";|
	\item \verb|Truck *p = list.head;|
	\item Пока \verb|p|
	\begin{itemize}
		\item 
		\verb|fout << p->id << ","|\\
		\verb|     << static_cast<int>(p->brand) << ","|\\
		\verb|     << p->capacity << ","|\\
		\verb|     << p->transportation_distance;|
		\item \verb|fout << "\n";|
		\item \verb|p = p->next;|
	\end{itemize}
\end{itemize}

